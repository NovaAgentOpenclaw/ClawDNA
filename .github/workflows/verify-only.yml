name: Verify ClawDNA Program (No Build)

on:
  workflow_dispatch:

env:
  SOLANA_VERSION: 1.18.0

jobs:
  verify:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install Solana CLI
      run: |
        curl -L -o solana.tar.bz2 "https://github.com/solana-labs/solana/releases/download/v${SOLANA_VERSION}/solana-release-x86_64-unknown-linux-gnu.tar.bz2"
        tar -xjf solana.tar.bz2
        mv solana-release/bin/* /usr/local/bin/
        solana --version

    - name: Configure Solana
      run: |
        solana config set --url devnet
        mkdir -p ~/.config/solana
        solana-keygen new --no-passphrase --force -o ~/.config/solana/id.json
        solana config get

    - name: Verify deployed program
      run: |
        PROGRAM_ID=$(cat clawdna/DEPLOYED_PROGRAM_ID.txt)
        echo "========================================"
        echo "Checking ClawDNA Program on Devnet"
        echo "========================================"
        echo "Program ID: $PROGRAM_ID"
        echo ""
        solana program show "$PROGRAM_ID"
        echo ""
        echo "âœ… ClawDNA Program Verified!"
        echo "Explorer: https://explorer.solana.com/address/$PROGRAM_ID?cluster=devnet"
        echo "========================================"

    - name: Upload Program ID
      uses: actions/upload-artifact@v4
      with:
        name: program-info
        path: clawdna/DEPLOYED_PROGRAM_ID.txt
